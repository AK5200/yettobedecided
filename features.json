[
  {
    "id": 1,
    "category": "database",
    "description": "Add admin_note column to posts table",
    "steps": [
      "Step 1: Create file supabase/migrations/003_add_admin_note.sql",
      "Step 2: Add this SQL content:",
      "  -- Add admin_note for rejection reasons etc",
      "  ALTER TABLE posts ADD COLUMN IF NOT EXISTS admin_note TEXT;",
      "Step 3: Save the file",
      "Step 4: Log: User must run this SQL in Supabase SQL Editor",
      "Step 5: Run: git add -A && git commit -m 'feat: add admin_note migration'"
    ],
    "passes": true
  },
  {
    "id": 2,
    "category": "types",
    "description": "Update Post type to include admin_note",
    "steps": [
      "Step 1: Open file lib/types/database.ts",
      "Step 2: Find the Post interface",
      "Step 3: Find the line: is_pinned: boolean",
      "Step 4: Add new line after it: admin_note: string | null",
      "Step 5: Save the file",
      "Step 6: Run: npm run build",
      "Step 7: Run: git add -A && git commit -m 'feat: add admin_note to Post type'"
    ],
    "passes": true
  },
  {
    "id": 3,
    "category": "api",
    "description": "Update posts PATCH API to handle admin_note",
    "steps": [
      "Step 1: Open file app/api/posts/[id]/route.ts",
      "Step 2: Find the PATCH function",
      "Step 3: Find where it builds the updates object",
      "Step 4: Add this line after the is_pinned check:",
      "  if (body.admin_note !== undefined) updates.admin_note = body.admin_note",
      "Step 5: Save the file",
      "Step 6: Run: npm run build",
      "Step 7: Run: git add -A && git commit -m 'feat: add admin_note to posts API'"
    ],
    "passes": true
  },
  {
    "id": 4,
    "category": "components",
    "description": "Create PostStatusSelect component for changing status",
    "steps": [
      "Step 1: Create file components/boards/post-status-select.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add import: import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'",
      "Step 4: Create interface PostStatusSelectProps with:",
      "  - postId: string",
      "  - currentStatus: string",
      "  - onStatusChange: (status: string) => void",
      "Step 5: Export function PostStatusSelect({ postId, currentStatus, onStatusChange }: PostStatusSelectProps)",
      "Step 6: Create statuses array: ['open', 'planned', 'in_progress', 'shipped', 'closed']",
      "Step 7: Return Select component:",
      "  - value={currentStatus}",
      "  - onValueChange={onStatusChange}",
      "  - SelectTrigger with className='w-32'",
      "  - SelectContent with map over statuses, each SelectItem with value and label",
      "Step 8: Save the file",
      "Step 9: Run: npm run build",
      "Step 10: Run: git add -A && git commit -m 'feat: add PostStatusSelect component'"
    ],
    "passes": true
  },
  {
    "id": 5,
    "category": "components",
    "description": "Create PostAdminActions component for approve/reject/pin",
    "steps": [
      "Step 1: Create file components/boards/post-admin-actions.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add imports:",
      "  - import { useState } from 'react'",
      "  - import { Button } from '@/components/ui/button'",
      "  - import { Textarea } from '@/components/ui/textarea'",
      "  - import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'",
      "Step 4: Create interface PostAdminActionsProps with:",
      "  - postId: string",
      "  - isApproved: boolean",
      "  - isPinned: boolean",
      "  - onUpdate: () => void",
      "Step 5: Export function PostAdminActions({ postId, isApproved, isPinned, onUpdate }: PostAdminActionsProps)",
      "Step 6: Add state: const [loading, setLoading] = useState(false)",
      "Step 7: Add state: const [rejectNote, setRejectNote] = useState('')",
      "Step 8: Add state: const [showRejectDialog, setShowRejectDialog] = useState(false)",
      "Step 9: Create handleApprove async function:",
      "  - setLoading(true)",
      "  - fetch(`/api/posts/${postId}`, { method: 'PATCH', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ is_approved: true }) })",
      "  - onUpdate()",
      "  - setLoading(false)",
      "Step 10: Create handleReject async function:",
      "  - setLoading(true)",
      "  - fetch(`/api/posts/${postId}`, { method: 'PATCH', headers, body: JSON.stringify({ is_approved: false, admin_note: rejectNote }) })",
      "  - setShowRejectDialog(false)",
      "  - onUpdate()",
      "  - setLoading(false)",
      "Step 11: Create handleTogglePin async function:",
      "  - setLoading(true)",
      "  - fetch(`/api/posts/${postId}`, { method: 'PATCH', headers, body: JSON.stringify({ is_pinned: !isPinned }) })",
      "  - onUpdate()",
      "  - setLoading(false)",
      "Step 12: Return JSX with flex row of buttons:",
      "  - If not approved: Button 'Approve' onClick={handleApprove}",
      "  - Dialog for reject with Textarea for reason",
      "  - Button to toggle pin (shows 'Unpin' if pinned, 'Pin' if not)",
      "Step 13: Save the file",
      "Step 14: Run: npm run build",
      "Step 15: Run: git add -A && git commit -m 'feat: add PostAdminActions component'"
    ],
    "passes": true
  },
  {
    "id": 6,
    "category": "components",
    "description": "Create PostCard component for admin view",
    "steps": [
      "Step 1: Create file components/boards/post-card.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add imports:",
      "  - import { Card, CardContent } from '@/components/ui/card'",
      "  - import { Badge } from '@/components/ui/badge'",
      "  - import { PostStatusSelect } from './post-status-select'",
      "  - import { PostAdminActions } from './post-admin-actions'",
      "  - import type { Post } from '@/lib/types/database'",
      "Step 4: Create interface PostCardProps:",
      "  - post: Post",
      "  - onUpdate: () => void",
      "Step 5: Export function PostCard({ post, onUpdate }: PostCardProps)",
      "Step 6: Create handleStatusChange async function:",
      "  - Takes newStatus: string",
      "  - fetch(`/api/posts/${post.id}`, { method: 'PATCH', headers, body: JSON.stringify({ status: newStatus }) })",
      "  - onUpdate()",
      "Step 7: Return Card with CardContent:",
      "  - Flex container with gap-4",
      "  - Left side: vote count in a div with border, centered",
      "  - Middle: title (bold), content (gray), author info",
      "  - Show admin_note if exists with red text: 'Rejection note: {post.admin_note}'",
      "  - Right side: PostStatusSelect and PostAdminActions",
      "  - Show Badge for 'Pending' if not approved, 'Pinned' if pinned",
      "Step 8: Save the file",
      "Step 9: Run: npm run build",
      "Step 10: Run: git add -A && git commit -m 'feat: add PostCard component'"
    ],
    "passes": false
  },
  {
    "id": 7,
    "category": "components",
    "description": "Create BoardPostsList client component",
    "steps": [
      "Step 1: Create file components/boards/board-posts-list.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add imports:",
      "  - import { useState, useEffect } from 'react'",
      "  - import { createClient } from '@/lib/supabase/client'",
      "  - import { PostCard } from './post-card'",
      "  - import type { Post } from '@/lib/types/database'",
      "Step 4: Create interface BoardPostsListProps:",
      "  - boardId: string",
      "  - initialPosts: Post[]",
      "Step 5: Export function BoardPostsList({ boardId, initialPosts }: BoardPostsListProps)",
      "Step 6: Add state: const [posts, setPosts] = useState<Post[]>(initialPosts)",
      "Step 7: Create fetchPosts async function:",
      "  - const supabase = createClient()",
      "  - const { data } = await supabase.from('posts').select('*').eq('board_id', boardId).order('is_pinned', { ascending: false }).order('vote_count', { ascending: false })",
      "  - if (data) setPosts(data)",
      "Step 8: Return JSX:",
      "  - If no posts: p with 'No feedback yet'",
      "  - If posts: div with className='space-y-4'",
      "  - Map posts, render PostCard with key={post.id} post={post} onUpdate={fetchPosts}",
      "Step 9: Save the file",
      "Step 10: Run: npm run build",
      "Step 11: Run: git add -A && git commit -m 'feat: add BoardPostsList component'"
    ],
    "passes": false
  },
  {
    "id": 8,
    "category": "pages",
    "description": "Update board detail page to use BoardPostsList",
    "steps": [
      "Step 1: Open file app/(dashboard)/boards/[id]/page.tsx",
      "Step 2: Add import at top: import { BoardPostsList } from '@/components/boards/board-posts-list'",
      "Step 3: Find where posts are displayed (look for map over posts or posts section)",
      "Step 4: Replace the posts display section with:",
      "  <BoardPostsList boardId={id} initialPosts={posts || []} />",
      "Step 5: Keep the header section with board name, description, and back link",
      "Step 6: Remove any old post mapping code that was replaced",
      "Step 7: Save the file",
      "Step 8: Run: npm run build",
      "Step 9: Run: git add -A && git commit -m 'feat: use BoardPostsList in board detail'"
    ],
    "passes": false
  },
  {
    "id": 9,
    "category": "components",
    "description": "Create CommentForm component",
    "steps": [
      "Step 1: Create file components/boards/comment-form.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add imports:",
      "  - import { useState } from 'react'",
      "  - import { Button } from '@/components/ui/button'",
      "  - import { Textarea } from '@/components/ui/textarea'",
      "Step 4: Create interface CommentFormProps:",
      "  - postId: string",
      "  - isAdmin?: boolean",
      "  - authorEmail?: string",
      "  - authorName?: string",
      "  - onCommentAdded: () => void",
      "Step 5: Export function CommentForm({ postId, isAdmin, authorEmail, authorName, onCommentAdded }: CommentFormProps)",
      "Step 6: Add state: const [content, setContent] = useState('')",
      "Step 7: Add state: const [loading, setLoading] = useState(false)",
      "Step 8: Create handleSubmit async function:",
      "  - e.preventDefault()",
      "  - if (!content.trim()) return",
      "  - setLoading(true)",
      "  - fetch('/api/comments', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ post_id: postId, content, author_email: authorEmail, author_name: authorName, is_from_admin: isAdmin || false }) })",
      "  - setContent('')",
      "  - onCommentAdded()",
      "  - setLoading(false)",
      "Step 9: Return form with onSubmit={handleSubmit}:",
      "  - Textarea value={content} onChange={(e) => setContent(e.target.value)} placeholder='Write a comment...' className='mb-2'",
      "  - Button type='submit' disabled={loading || !content.trim()} text={loading ? 'Posting...' : 'Post Comment'}",
      "Step 10: Save the file",
      "Step 11: Run: npm run build",
      "Step 12: Run: git add -A && git commit -m 'feat: add CommentForm component'"
    ],
    "passes": false
  },
  {
    "id": 10,
    "category": "components",
    "description": "Create CommentList component",
    "steps": [
      "Step 1: Create file components/boards/comment-list.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add imports:",
      "  - import { useState, useEffect } from 'react'",
      "  - import { createClient } from '@/lib/supabase/client'",
      "  - import { Badge } from '@/components/ui/badge'",
      "  - import type { Comment } from '@/lib/types/database'",
      "Step 4: Create interface CommentListProps:",
      "  - postId: string",
      "  - refreshTrigger?: number",
      "Step 5: Export function CommentList({ postId, refreshTrigger }: CommentListProps)",
      "Step 6: Add state: const [comments, setComments] = useState<Comment[]>([])",
      "Step 7: Add state: const [loading, setLoading] = useState(true)",
      "Step 8: Create fetchComments async function:",
      "  - const supabase = createClient()",
      "  - const { data } = await supabase.from('comments').select('*').eq('post_id', postId).order('created_at', { ascending: true })",
      "  - if (data) setComments(data)",
      "  - setLoading(false)",
      "Step 9: Add useEffect: useEffect(() => { fetchComments() }, [postId, refreshTrigger])",
      "Step 10: Return JSX:",
      "  - If loading: p with 'Loading comments...'",
      "  - If no comments: p with 'No comments yet'",
      "  - If comments: div with className='space-y-3'",
      "  - Map comments, each showing:",
      "    - div with className='border-l-2 border-gray-200 pl-3 py-2'",
      "    - div with flex: span with author_name or 'Anonymous', and if is_from_admin show Badge 'Admin'",
      "    - p with content",
      "    - small with date: new Date(comment.created_at).toLocaleDateString()",
      "Step 11: Save the file",
      "Step 12: Run: npm run build",
      "Step 13: Run: git add -A && git commit -m 'feat: add CommentList component'"
    ],
    "passes": false
  },
  {
    "id": 11,
    "category": "components",
    "description": "Create PostDetailDialog for viewing post with comments",
    "steps": [
      "Step 1: Create file components/boards/post-detail-dialog.tsx",
      "Step 2: Add 'use client' as first line",
      "Step 3: Add imports:",
      "  - import { useState } from 'react'",
      "  - import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'",
      "  - import { Badge } from '@/components/ui/badge'",
      "  - import { Separator } from '@/components/ui/separator'",
      "  - import { CommentList } from './comment-list'",
      "  - import { CommentForm } from './comment-form'",
      "  - import type { Post } from '@/lib/types/database'",
      "Step 4: Create interface PostDetailDialogProps:",
      "  - post: Post",
      "  - isAdmin?: boolean",
      "  - adminEmail?: string",
      "  - children: React.ReactNode",
      "Step 5: Export function PostDetailDialog({ post, isAdmin, adminEmail, children }: PostDetailDialogProps)",
      "Step 6: Add state: const [refreshTrigger, setRefreshTrigger] = useState(0)",
      "Step 7: Create handleCommentAdded: setRefreshTrigger(prev => prev + 1)",
      "Step 8: Return Dialog:",
      "  - DialogTrigger asChild>{children}</DialogTrigger>",
      "  - DialogContent className='max-w-2xl max-h-[80vh] overflow-y-auto'",
      "  - DialogHeader with DialogTitle>{post.title}</DialogTitle>",
      "  - div with post content",
      "  - div with flex gap-2: Badge for status, Badge for vote count",
      "  - p with author info: 'By {post.author_name || 'Anonymous'}'",
      "  - If post.admin_note: p with className='text-red-600' showing note",
      "  - Separator className='my-4'",
      "  - h3 className='font-semibold mb-2' text 'Comments'",
      "  - CommentList postId={post.id} refreshTrigger={refreshTrigger}",
      "  - Separator className='my-4'",
      "  - CommentForm postId={post.id} isAdmin={isAdmin} authorEmail={adminEmail} authorName={isAdmin ? 'Admin' : undefined} onCommentAdded={handleCommentAdded}",
      "Step 9: Save the file",
      "Step 10: Run: npm run build",
      "Step 11: Run: git add -A && git commit -m 'feat: add PostDetailDialog component'"
    ],
    "passes": false
  },
  {
    "id": 12,
    "category": "components",
    "description": "Update PostCard to include dialog and admin props",
    "steps": [
      "Step 1: Open file components/boards/post-card.tsx",
      "Step 2: Add import: import { PostDetailDialog } from './post-detail-dialog'",
      "Step 3: Update PostCardProps interface to add:",
      "  - isAdmin?: boolean",
      "  - adminEmail?: string",
      "Step 4: Update function signature to include new props",
      "Step 5: Find the main content area (title, content, author info)",
      "Step 6: Wrap that content with PostDetailDialog:",
      "  <PostDetailDialog post={post} isAdmin={isAdmin} adminEmail={adminEmail}>",
      "    <div className='flex-1 cursor-pointer'>",
      "      ... existing title, content, author markup ...",
      "    </div>",
      "  </PostDetailDialog>",
      "Step 7: Keep the action buttons (status select, admin actions) outside the dialog",
      "Step 8: Save the file",
      "Step 9: Run: npm run build",
      "Step 10: Run: git add -A && git commit -m 'feat: PostCard with dialog and admin props'"
    ],
    "passes": false
  },
  {
    "id": 13,
    "category": "components",
    "description": "Update BoardPostsList to pass admin props",
    "steps": [
      "Step 1: Open file components/boards/board-posts-list.tsx",
      "Step 2: Update BoardPostsListProps interface to add:",
      "  - isAdmin?: boolean",
      "  - adminEmail?: string",
      "Step 3: Update function signature to receive these props",
      "Step 4: Update PostCard rendering to pass props:",
      "  <PostCard key={post.id} post={post} onUpdate={fetchPosts} isAdmin={isAdmin} adminEmail={adminEmail} />",
      "Step 5: Save the file",
      "Step 6: Run: npm run build",
      "Step 7: Run: git add -A && git commit -m 'feat: BoardPostsList passes admin props'"
    ],
    "passes": false
  },
  {
    "id": 14,
    "category": "pages",
    "description": "Update board detail page to pass admin info",
    "steps": [
      "Step 1: Open file app/(dashboard)/boards/[id]/page.tsx",
      "Step 2: Find the BoardPostsList component",
      "Step 3: Update it to pass admin props:",
      "  <BoardPostsList boardId={id} initialPosts={posts || []} isAdmin={true} adminEmail={user?.email || ''} />",
      "Step 4: Make sure user is available in the component (should be from auth check)",
      "Step 5: If user is not available, add: const { data: { user } } = await supabase.auth.getUser()",
      "Step 6: Save the file",
      "Step 7: Run: npm run build",
      "Step 8: Run: git add -A && git commit -m 'feat: board detail passes admin info'"
    ],
    "passes": false
  },
  {
    "id": 15,
    "category": "pages",
    "description": "Add pending posts section to board detail",
    "steps": [
      "Step 1: Open file app/(dashboard)/boards/[id]/page.tsx",
      "Step 2: Find the posts query",
      "Step 3: Create two separate queries:",
      "  - const { data: pendingPosts } = await supabase.from('posts').select('*').eq('board_id', id).eq('is_approved', false).order('created_at', { ascending: false })",
      "  - const { data: approvedPosts } = await supabase.from('posts').select('*').eq('board_id', id).eq('is_approved', true).order('is_pinned', { ascending: false }).order('vote_count', { ascending: false })",
      "Step 4: Update the JSX to show two sections:",
      "  - First section: h2 'Pending Approval ({pendingPosts?.length || 0})' with className='text-lg font-semibold mb-4 mt-8'",
      "  - BoardPostsList for pending: boardId={id} initialPosts={pendingPosts || []} isAdmin={true} adminEmail={user?.email}",
      "  - Second section: h2 'Approved Posts ({approvedPosts?.length || 0})' with same className",
      "  - BoardPostsList for approved: boardId={id} initialPosts={approvedPosts || []} isAdmin={true} adminEmail={user?.email}",
      "Step 5: Remove or update the old single BoardPostsList",
      "Step 6: Save the file",
      "Step 7: Run: npm run build",
      "Step 8: Run: git add -A && git commit -m 'feat: show pending and approved posts separately'"
    ],
    "passes": false
  },
  {
    "id": 16,
    "category": "public",
    "description": "Update public board page with better post submission form",
    "steps": [
      "Step 1: Open file app/[orgSlug]/[boardSlug]/page.tsx",
      "Step 2: Find or add state for the form:",
      "  - const [newTitle, setNewTitle] = useState('')",
      "  - const [newContent, setNewContent] = useState('')",
      "  - const [authorName, setAuthorName] = useState('')",
      "  - const [authorEmail, setAuthorEmail] = useState('')",
      "  - const [submitLoading, setSubmitLoading] = useState(false)",
      "Step 3: Create handleSubmitPost async function:",
      "  - e.preventDefault()",
      "  - if (!newTitle.trim()) return",
      "  - setSubmitLoading(true)",
      "  - await fetch('/api/posts', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ board_id: board.id, title: newTitle, content: newContent, author_name: authorName, author_email: authorEmail }) })",
      "  - setNewTitle(''), setNewContent(''), setAuthorName(''), setAuthorEmail('')",
      "  - Refresh posts",
      "  - setSubmitLoading(false)",
      "Step 4: Add form JSX before the posts list:",
      "  - div with className='border p-4 rounded mb-8'",
      "  - h3 'Submit Feedback' className='font-semibold mb-4'",
      "  - form onSubmit={handleSubmitPost}",
      "  - Input for name placeholder='Your name (optional)'",
      "  - Input for email placeholder='Your email (optional)'",
      "  - Input for title placeholder='Feedback title' required",
      "  - Textarea for content placeholder='Describe your feedback...'",
      "  - Button type='submit' disabled={submitLoading || !newTitle.trim()}",
      "Step 5: Save the file",
      "Step 6: Run: npm run build",
      "Step 7: Run: git add -A && git commit -m 'feat: public board has better post form'"
    ],
    "passes": false
  },
  {
    "id": 17,
    "category": "public",
    "description": "Add comments to public board posts",
    "steps": [
      "Step 1: Open file app/[orgSlug]/[boardSlug]/page.tsx",
      "Step 2: Add imports at top:",
      "  - import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'",
      "  - import { CommentList } from '@/components/boards/comment-list'",
      "  - import { CommentForm } from '@/components/boards/comment-form'",
      "  - import { Separator } from '@/components/ui/separator'",
      "Step 3: Add state for comment refresh: const [commentRefresh, setCommentRefresh] = useState(0)",
      "Step 4: Find where posts are listed (the map over posts)",
      "Step 5: Wrap each post card with Dialog:",
      "  <Dialog key={post.id}>",
      "    <DialogTrigger asChild>",
      "      <div className='cursor-pointer'> ... existing post card content ... </div>",
      "    </DialogTrigger>",
      "    <DialogContent className='max-w-2xl max-h-[80vh] overflow-y-auto'>",
      "      <DialogHeader><DialogTitle>{post.title}</DialogTitle></DialogHeader>",
      "      <p>{post.content}</p>",
      "      <p className='text-sm text-gray-500'>By {post.author_name || 'Anonymous'} â€¢ {post.vote_count} votes</p>",
      "      <Separator className='my-4' />",
      "      <h3 className='font-semibold'>Comments</h3>",
      "      <CommentList postId={post.id} refreshTrigger={commentRefresh} />",
      "      <Separator className='my-4' />",
      "      <CommentForm postId={post.id} authorEmail={authorEmail} authorName={authorName} onCommentAdded={() => setCommentRefresh(prev => prev + 1)} />",
      "    </DialogContent>",
      "  </Dialog>",
      "Step 6: Save the file",
      "Step 7: Run: npm run build",
      "Step 8: Run: git add -A && git commit -m 'feat: public board posts have comments'"
    ],
    "passes": false
  },
  {
    "id": 18,
    "category": "test",
    "description": "Final build test",
    "steps": [
      "Step 1: Run: npm run build",
      "Step 2: Check for any TypeScript errors",
      "Step 3: If errors, fix them one by one",
      "Step 4: Run: npm run build again after fixes",
      "Step 5: Verify build succeeds with no errors",
      "Step 6: Run: git add -A",
      "Step 7: Run: git commit -m 'feat: post management and comments complete'"
    ],
    "passes": false
  }
]
